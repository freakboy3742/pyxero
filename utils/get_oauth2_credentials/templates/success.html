<p class="mt-3">
    Congratulations! You have successfully connected to the Xero organisation {organisation}!
</p>
<div class="alert alert-warning">
  Please note this web server has now self-terminated, so you will not be able to reload this page without manually restarting it.
</div>
<div class="card mt-3 mb-5">
    <div class="card-body">
        <p>
          Here are some contacts retrieved from the Xero API
        </p>
          <table class="table table-bordered table-striped table-hover">
              <thead>
              <tr>
                  <th>
                    Name
                  </th>
                  <th>
                      GUID
                  </th>
              </tr>
              </thead>
              <tbody>
              {contacts}
              </tbody>
          </table>
    </div>
</div>

<div class="card mt-3 mb-5">
    <div class="card-body">
      <p>
        You should now be able
        <a
          href="#"
          id="copy"
        >to copy and paste the following code</a>
        into an interactive Python session.
      </p>
<pre>
<code class="d-block" style="background-color: antiquewhite" id="code-block">
def get_xero():
    import json
    from xero import Xero
    from xero.auth import OAuth2Credentials

    STATE_FILE = '{state_file_path}'

    def read_state_file() -> dict:
        try:
            with open(STATE_FILE, 'r') as f:
                try:
                    return json.load(f)
                except json.decoder.JSONDecodeError:
                    return {{}} <!-- Doubled for escaping as we will run this whole document through str.format() -->
        except FileNotFoundError:
            return {{}} <!-- Doubled for escaping as we will run this whole document through str.format() -->


    def write_state_file(state: dict) -> None:
        with open(STATE_FILE, 'w') as f:
            json.dump(state, f, indent=2, sort_keys=True)

    state = read_state_file()

    if state:
        credentials = OAuth2Credentials(**state)
        if credentials.expired(seconds=200):
            try:
                credentials.refresh()
            except Exception as e:
                print('Unable to refresh - try re-authenticating and ensure that offline_access scope is enabled')
                raise
            else:
                write_state_file(credentials.state)
        return Xero(credentials)
    return

xero = get_xero()

print('Now you can interact with the xero object like xero.invoices.filter(page=1)')
</code>
</pre>
    </div>
</div>

<script>
  document.querySelector('#copy').addEventListener('click', (ev) => {{ <!-- Doubled for escaping as we will run this whole document through str.format() -->
    ev.preventDefault();
    let codeBlock = document.querySelector('#code-block');
    navigator.clipboard.writeText(codeBlock.innerText).then(() => {{alert('Code block copied!')}})
  }}); <!-- Doubled for escaping as we will run this whole document through str.format() -->
</script>